<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Worxed Alert Manager</title>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'VT323', monospace;
            background: #121318;
            color: #8cffbe;
            overflow-x: hidden;
            font-size: 18px;
            letter-spacing: 1px;
            line-height: 1.4;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: rgba(140, 255, 190, 0.05);
            border: 2px solid #8cffbe;
            border-radius: 12px;
            box-shadow: 0 0 30px rgba(140, 255, 190, 0.2);
        }

        .header h1 {
            font-size: 3rem;
            color: #8cffbe;
            text-shadow: 0 0 15px rgba(140, 255, 190, 0.5);
            margin-bottom: 10px;
        }

        .header p {
            color: #b893ff;
            font-size: 1.2rem;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(18, 19, 24, 0.9);
            border: 2px solid #8cffbe;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 0 20px rgba(140, 255, 190, 0.1);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(140, 255, 190, 0.2);
        }

        .card h3 {
            color: #b893ff;
            font-size: 1.5rem;
            margin-bottom: 20px;
            text-shadow: 0 0 8px rgba(184, 147, 255, 0.5);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            color: #8cffbe;
            margin-bottom: 5px;
            font-size: 1rem;
        }

        .form-input {
            width: 100%;
            padding: 10px 15px;
            background: rgba(18, 19, 24, 0.8);
            border: 1px solid #b893ff;
            border-radius: 6px;
            color: #8cffbe;
            font-family: 'VT323', monospace;
            font-size: 16px;
        }

        .form-input:focus {
            outline: none;
            border-color: #8cffbe;
            box-shadow: 0 0 10px rgba(140, 255, 190, 0.3);
        }

        .btn {
            background: linear-gradient(45deg, #8cffbe, #b893ff);
            color: #121318;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'VT323', monospace;
            font-size: 16px;
            font-weight: bold;
            margin: 5px;
            transition: all 0.3s ease;
            text-transform: uppercase;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(140, 255, 190, 0.3);
        }

        .btn-danger {
            background: linear-gradient(45deg, #ff4757, #ff6b7a);
            color: white;
        }

        .btn-success {
            background: linear-gradient(45deg, #2ed573, #7bed9f);
            color: white;
        }

        .status-panel {
            background: rgba(18, 19, 24, 0.9);
            border: 2px solid #b893ff;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .status-item {
            text-align: center;
            padding: 15px;
            background: rgba(140, 255, 190, 0.05);
            border: 1px solid #8cffbe;
            border-radius: 8px;
        }

        .status-value {
            font-size: 2rem;
            color: #8cffbe;
            text-shadow: 0 0 10px rgba(140, 255, 190, 0.5);
        }

        .status-label {
            color: #b893ff;
            font-size: 1rem;
            margin-top: 5px;
        }

        .webhook-info {
            background: rgba(184, 147, 255, 0.1);
            border: 1px solid #b893ff;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
        }

        .webhook-url {
            background: rgba(18, 19, 24, 0.8);
            padding: 10px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            word-break: break-all;
            margin: 10px 0;
            border: 1px solid #8cffbe;
        }

        .alert-log {
            max-height: 300px;
            overflow-y: auto;
            background: rgba(18, 19, 24, 0.8);
            border: 1px solid #8cffbe;
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
        }

        .log-entry {
            padding: 8px 0;
            border-bottom: 1px solid rgba(140, 255, 190, 0.2);
            font-size: 14px;
        }

        .log-entry:last-child {
            border-bottom: none;
        }

        .log-time {
            color: #b893ff;
            margin-right: 10px;
        }

        .log-type {
            color: #8cffbe;
            font-weight: bold;
            margin-right: 10px;
        }

        .log-message {
            color: #ffffff;
        }

        @keyframes terminalGlow {
            0%, 100% { text-shadow: 0 0 8px rgba(140, 255, 190, 0.5); }
            50% { text-shadow: 0 0 15px rgba(140, 255, 190, 0.8); }
        }

        .glow {
            animation: terminalGlow 2s infinite;
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #8cffbe;
        }

        .tab {
            padding: 15px 25px;
            background: rgba(18, 19, 24, 0.8);
            border: 1px solid #8cffbe;
            border-bottom: none;
            cursor: pointer;
            font-family: 'VT323', monospace;
            font-size: 16px;
            color: #8cffbe;
            transition: all 0.3s ease;
        }

        .tab.active {
            background: rgba(140, 255, 190, 0.1);
            color: #b893ff;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="glow">ðŸš¨ WORXED ALERT MANAGER</h1>
            <p>Complete control over your stream alerts - no third-party dependencies</p>
        </div>

        <div class="status-panel">
            <h3 style="color: #b893ff; margin-bottom: 20px;"><i class="fas fa-chart-line"></i> Live Statistics</h3>
            <div class="status-grid">
                <div class="status-item">
                    <div class="status-value" id="followerCount">0</div>
                    <div class="status-label">Total Followers</div>
                </div>
                <div class="status-item">
                    <div class="status-value" id="viewerCount">0</div>
                    <div class="status-label">Current Viewers</div>
                </div>
                <div class="status-item">
                    <div class="status-value" id="chatMessages">0</div>
                    <div class="status-label">Chat Messages</div>
                </div>
                <div class="status-item">
                    <div class="status-value" id="uptime">00:00:00</div>
                    <div class="status-label">Stream Uptime</div>
                </div>
            </div>
        </div>

        <div class="tabs">
            <div class="tab active" data-tab="alerts">Alert Testing</div>
            <div class="tab" data-tab="config">Stream Config</div>
            <div class="tab" data-tab="webhooks">Webhook Setup</div>
            <div class="tab" data-tab="analytics">Analytics</div>
            <div class="tab" data-tab="logs">Event Logs</div>
        </div>

        <div class="tab-content active" id="alerts">
            <div class="grid">
                <!-- Follower Alert -->
                <div class="card">
                    <h3><i class="fas fa-user-plus"></i> Follower Alert</h3>
                    <div class="form-group">
                        <label class="form-label">Username</label>
                        <input type="text" class="form-input" id="followerUsername" placeholder="NewFollower123">
                    </div>
                    <button class="btn" onclick="testFollowerAlert()">Test Follower Alert</button>
                </div>

                <!-- Subscriber Alert -->
                <div class="card">
                    <h3><i class="fas fa-star"></i> Subscriber Alert</h3>
                    <div class="form-group">
                        <label class="form-label">Username</label>
                        <input type="text" class="form-input" id="subUsername" placeholder="NewSubscriber">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Tier</label>
                        <select class="form-input" id="subTier">
                            <option value="1000">Tier 1</option>
                            <option value="2000">Tier 2</option>
                            <option value="3000">Tier 3</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Message</label>
                        <input type="text" class="form-input" id="subMessage" placeholder="Thanks for the sub!">
                    </div>
                    <button class="btn" onclick="testSubscriberAlert()">Test Subscriber Alert</button>
                </div>

                <!-- Donation Alert -->
                <div class="card">
                    <h3><i class="fas fa-dollar-sign"></i> Donation Alert</h3>
                    <div class="form-group">
                        <label class="form-label">Username</label>
                        <input type="text" class="form-input" id="donationUsername" placeholder="GenerousViewer">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Amount</label>
                        <input type="number" class="form-input" id="donationAmount" placeholder="5.00" step="0.01">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Message</label>
                        <input type="text" class="form-input" id="donationMessage" placeholder="Keep up the great work!">
                    </div>
                    <button class="btn" onclick="testDonationAlert()">Test Donation Alert</button>
                </div>

                <!-- Cheer Alert -->
                <div class="card">
                    <h3><i class="fas fa-gem"></i> Cheer Alert</h3>
                    <div class="form-group">
                        <label class="form-label">Username</label>
                        <input type="text" class="form-input" id="cheerUsername" placeholder="BitsCheerer">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Bits Amount</label>
                        <input type="number" class="form-input" id="cheerBits" placeholder="100">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Message</label>
                        <input type="text" class="form-input" id="cheerMessage" placeholder="Cheer100 Amazing stream!">
                    </div>
                    <button class="btn" onclick="testCheerAlert()">Test Cheer Alert</button>
                </div>

                <!-- Raid Alert -->
                <div class="card">
                    <h3><i class="fas fa-users"></i> Raid Alert</h3>
                    <div class="form-group">
                        <label class="form-label">Raider Username</label>
                        <input type="text" class="form-input" id="raidUsername" placeholder="RaidLeader">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Viewer Count</label>
                        <input type="number" class="form-input" id="raidViewers" placeholder="50">
                    </div>
                    <button class="btn" onclick="testRaidAlert()">Test Raid Alert</button>
                </div>

                <!-- Custom Alert -->
                <div class="card">
                    <h3><i class="fas fa-bell"></i> Custom Alert</h3>
                    <div class="form-group">
                        <label class="form-label">Alert Type</label>
                        <select class="form-input" id="customType">
                            <option value="milestone">Milestone</option>
                            <option value="shoutout">Shoutout</option>
                            <option value="mod-action">Mod Action</option>
                            <option value="custom-event">Custom Event</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Title</label>
                        <input type="text" class="form-input" id="customTitle" placeholder="Special Event!">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Message</label>
                        <input type="text" class="form-input" id="customMessage" placeholder="Something awesome happened!">
                    </div>
                    <button class="btn" onclick="testCustomAlert()">Test Custom Alert</button>
                </div>
            </div>
        </div>

        <div class="tab-content" id="config">
            <div class="grid">
                <!-- Current Stream Configuration -->
                <div class="card">
                    <h3><i class="fas fa-cog"></i> Current Stream Configuration</h3>
                    <div class="form-group">
                        <label class="form-label">Twitch Channel</label>
                        <input type="text" class="form-input" id="currentChannel" placeholder="your_username">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Bot Username</label>
                        <input type="text" class="form-input" id="currentBotUsername" placeholder="your_username">
                    </div>
                    <div class="form-group">
                        <label class="form-label">OAuth Token</label>
                        <input type="password" class="form-input" id="currentOAuthToken" placeholder="oauth:your_token_here">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Client ID</label>
                        <input type="text" class="form-input" id="currentClientId" placeholder="your_client_id">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Client Secret</label>
                        <input type="password" class="form-input" id="currentClientSecret" placeholder="your_client_secret">
                    </div>
                    <button class="btn btn-success" onclick="updateCurrentConfig()">Update Current Stream</button>
                    <button class="btn" onclick="loadCurrentConfig()">Load Current Config</button>
                </div>

                <!-- Stream Profiles -->
                <div class="card">
                    <h3><i class="fas fa-users"></i> Stream Profiles</h3>
                    <p style="color: #b893ff; margin-bottom: 15px;">
                        Save and switch between different stream configurations
                    </p>
                    
                    <div class="form-group">
                        <label class="form-label">Profile Name</label>
                        <input type="text" class="form-input" id="profileName" placeholder="My Stream Profile">
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                        <button class="btn" onclick="saveProfile()">Save Current as Profile</button>
                        <button class="btn btn-success" onclick="loadProfile()">Load Selected Profile</button>
                        <button class="btn btn-danger" onclick="deleteProfile()">Delete Profile</button>
                    </div>

                    <div id="profilesList" style="max-height: 200px; overflow-y: auto;">
                        <!-- Profiles will be loaded here -->
                    </div>
                </div>

                <!-- Quick Stream Switcher -->
                <div class="card">
                    <h3><i class="fas fa-exchange-alt"></i> Quick Stream Switcher</h3>
                    <p style="color: #b893ff; margin-bottom: 15px;">
                        Quickly switch between your managed streams
                    </p>
                    
                    <div class="form-group">
                        <label class="form-label">Select Stream</label>
                        <select class="form-input" id="streamSelector">
                            <option value="">Select a stream...</option>
                        </select>
                    </div>
                    
                    <button class="btn btn-success" onclick="switchToStream()">Switch to Stream</button>
                    <button class="btn" onclick="addQuickStream()">Add Current Stream</button>
                </div>

                <!-- Server Configuration -->
                <div class="card">
                    <h3><i class="fas fa-server"></i> Server Configuration</h3>
                    <div class="form-group">
                        <label class="form-label">Server Port</label>
                        <input type="number" class="form-input" id="serverPort" placeholder="3000">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Webhook URL</label>
                        <input type="text" class="form-input" id="webhookUrl" placeholder="https://your-domain.com/webhooks/twitch">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Webhook Secret</label>
                        <input type="password" class="form-input" id="webhookSecret" placeholder="your_webhook_secret">
                    </div>
                    <button class="btn" onclick="updateServerConfig()">Update Server Config</button>
                </div>

                <!-- Configuration Export/Import -->
                <div class="card">
                    <h3><i class="fas fa-download"></i> Configuration Backup</h3>
                    <p style="color: #b893ff; margin-bottom: 15px;">
                        Backup and restore your entire configuration
                    </p>
                    
                    <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                        <button class="btn" onclick="exportAllConfigs()">Export All Configs</button>
                        <button class="btn" onclick="importConfigs()">Import Configs</button>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Configuration JSON</label>
                        <textarea class="form-input" id="configJson" rows="6" placeholder="Paste configuration JSON here..."></textarea>
                    </div>
                    
                    <button class="btn btn-success" onclick="applyJsonConfig()">Apply JSON Config</button>
                </div>
            </div>
        </div>

        <div class="tab-content" id="webhooks">
            <div class="grid">
                <div class="card">
                    <h3><i class="fas fa-link"></i> Twitch EventSub Webhooks</h3>
                    <p style="color: #b893ff; margin-bottom: 15px;">
                        Configure these webhooks in your Twitch Developer Console for real-time alerts:
                    </p>
                    <div class="webhook-info">
                        <strong>Webhook URL:</strong>
                        <div class="webhook-url" id="twitchWebhookUrl">https://your-domain.com/webhooks/twitch</div>
                        <button class="btn" onclick="copyWebhookUrl('twitchWebhookUrl')">Copy URL</button>
                    </div>
                    <p style="color: #8cffbe; margin-top: 15px; font-size: 14px;">
                        Supported events: Follows, Subscriptions, Cheers, Raids, Stream Online/Offline
                    </p>
                </div>

                <div class="card">
                    <h3><i class="fas fa-credit-card"></i> Donation Webhooks</h3>
                    <p style="color: #b893ff; margin-bottom: 15px;">
                        Use these endpoints for payment processor integrations:
                    </p>
                    <div class="webhook-info">
                        <strong>Donation Webhook:</strong>
                        <div class="webhook-url" id="donationWebhookUrl">https://your-domain.com/webhooks/donation</div>
                        <button class="btn" onclick="copyWebhookUrl('donationWebhookUrl')">Copy URL</button>
                    </div>
                    <div class="webhook-info">
                        <strong>Custom Alert API:</strong>
                        <div class="webhook-url" id="customAlertUrl">https://your-domain.com/api/custom-alert</div>
                        <button class="btn" onclick="copyWebhookUrl('customAlertUrl')">Copy URL</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-content" id="analytics">
            <div class="card">
                <h3><i class="fas fa-chart-bar"></i> Stream Analytics</h3>
                <div id="analyticsData">
                    <p style="color: #b893ff;">Loading analytics data...</p>
                </div>
                <button class="btn" onclick="refreshAnalytics()">Refresh Analytics</button>
            </div>
        </div>

        <div class="tab-content" id="logs">
            <div class="card">
                <h3><i class="fas fa-list"></i> Event Logs</h3>
                <div class="alert-log" id="eventLogs">
                    <div class="log-entry">
                        <span class="log-time">--:--:--</span>
                        <span class="log-type">SYSTEM</span>
                        <span class="log-message">Alert manager initialized</span>
                    </div>
                </div>
                <button class="btn btn-danger" onclick="clearLogs()">Clear Logs</button>
            </div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let eventLogs = [];

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            initializeTabs();
            updateWebhookUrls();
            refreshAnalytics();
            setInterval(refreshAnalytics, 30000); // Refresh every 30 seconds
        });

        // Tab functionality
        function initializeTabs() {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    const targetTab = tab.dataset.tab;
                    
                    // Update active tab
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    // Update active content
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(targetTab).classList.add('active');
                });
            });
        }

        // Update webhook URLs with current domain
        function updateWebhookUrls() {
            const baseUrl = window.location.origin;
            document.getElementById('twitchWebhookUrl').textContent = `${baseUrl}/webhooks/twitch`;
            document.getElementById('donationWebhookUrl').textContent = `${baseUrl}/webhooks/donation`;
            document.getElementById('customAlertUrl').textContent = `${baseUrl}/api/custom-alert`;
        }

        // Copy webhook URL to clipboard
        function copyWebhookUrl(elementId) {
            const text = document.getElementById(elementId).textContent;
            navigator.clipboard.writeText(text).then(() => {
                alert('Webhook URL copied to clipboard!');
            });
        }

        // Test alert functions
        function testFollowerAlert() {
            const username = document.getElementById('followerUsername').value || 'TestFollower';
            
            fetch('/api/custom-alert', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    type: 'custom-follow',
                    data: { username, timestamp: new Date().toISOString() }
                })
            });
            
            addLog('FOLLOWER', `Test follower alert sent for ${username}`);
        }

        function testSubscriberAlert() {
            const username = document.getElementById('subUsername').value || 'TestSubscriber';
            const tier = document.getElementById('subTier').value;
            const message = document.getElementById('subMessage').value;
            
            fetch('/api/custom-alert', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    type: 'custom-subscriber',
                    data: { username, tier, message, timestamp: new Date().toISOString() }
                })
            });
            
            addLog('SUBSCRIBER', `Test subscriber alert sent for ${username} (Tier ${tier/1000})`);
        }

        function testDonationAlert() {
            const username = document.getElementById('donationUsername').value || 'TestDonor';
            const amount = document.getElementById('donationAmount').value || '5.00';
            const message = document.getElementById('donationMessage').value;
            
            fetch('/webhooks/donation', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    username, amount, message, currency: 'USD', processor: 'test'
                })
            });
            
            addLog('DONATION', `Test donation alert sent: ${username} donated $${amount}`);
        }

        function testCheerAlert() {
            const username = document.getElementById('cheerUsername').value || 'TestCheerer';
            const bits = document.getElementById('cheerBits').value || '100';
            const message = document.getElementById('cheerMessage').value;
            
            fetch('/api/custom-alert', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    type: 'custom-cheer',
                    data: { username, bits, message, timestamp: new Date().toISOString() }
                })
            });
            
            addLog('CHEER', `Test cheer alert sent: ${username} cheered ${bits} bits`);
        }

        function testRaidAlert() {
            const username = document.getElementById('raidUsername').value || 'TestRaider';
            const viewers = document.getElementById('raidViewers').value || '50';
            
            fetch('/api/custom-alert', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    type: 'custom-raid',
                    data: { username, viewers, timestamp: new Date().toISOString() }
                })
            });
            
            addLog('RAID', `Test raid alert sent: ${username} raided with ${viewers} viewers`);
        }

        function testCustomAlert() {
            const type = document.getElementById('customType').value;
            const title = document.getElementById('customTitle').value || 'Test Event';
            const message = document.getElementById('customMessage').value || 'Test message';
            
            fetch('/api/custom-alert', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    type,
                    data: { title, message, timestamp: new Date().toISOString() }
                })
            });
            
            addLog('CUSTOM', `Custom alert sent: ${type} - ${title}`);
        }

        // Analytics
        async function refreshAnalytics() {
            try {
                const response = await fetch('/api/analytics');
                const data = await response.json();
                
                document.getElementById('followerCount').textContent = data.followers.total;
                document.getElementById('viewerCount').textContent = data.stream.viewers;
                document.getElementById('chatMessages').textContent = data.session.chatMessages;
                document.getElementById('uptime').textContent = formatUptime(data.uptime);
                
                // Update analytics tab
                const analyticsHtml = `
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                        <div style="background: rgba(140, 255, 190, 0.05); padding: 15px; border-radius: 8px; border: 1px solid #8cffbe;">
                            <h4 style="color: #8cffbe; margin-bottom: 10px;">Stream Status</h4>
                            <p><strong>Live:</strong> ${data.stream.isLive ? 'Yes' : 'No'}</p>
                            <p><strong>Game:</strong> ${data.stream.game}</p>
                            <p><strong>Title:</strong> ${data.stream.title}</p>
                            <p><strong>Viewers:</strong> ${data.stream.viewers}</p>
                        </div>
                        <div style="background: rgba(184, 147, 255, 0.05); padding: 15px; border-radius: 8px; border: 1px solid #b893ff;">
                            <h4 style="color: #b893ff; margin-bottom: 10px;">Session Stats</h4>
                            <p><strong>Chat Messages:</strong> ${data.session.chatMessages}</p>
                            <p><strong>New Followers:</strong> ${data.session.recentFollowers}</p>
                            <p><strong>New Subscribers:</strong> ${data.session.recentSubscribers}</p>
                            <p><strong>Donations:</strong> ${data.session.recentDonations}</p>
                        </div>
                    </div>
                `;
                document.getElementById('analyticsData').innerHTML = analyticsHtml;
                
            } catch (error) {
                console.error('Failed to fetch analytics:', error);
            }
        }

        function formatUptime(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        // Logging
        function addLog(type, message) {
            const time = new Date().toLocaleTimeString();
            eventLogs.unshift({ time, type, message });
            
            if (eventLogs.length > 100) {
                eventLogs = eventLogs.slice(0, 100);
            }
            
            updateLogDisplay();
        }

        function updateLogDisplay() {
            const logsHtml = eventLogs.map(log => `
                <div class="log-entry">
                    <span class="log-time">${log.time}</span>
                    <span class="log-type">${log.type}</span>
                    <span class="log-message">${log.message}</span>
                </div>
            `).join('');
            
            document.getElementById('eventLogs').innerHTML = logsHtml;
        }

        function clearLogs() {
            eventLogs = [];
            updateLogDisplay();
            addLog('SYSTEM', 'Event logs cleared');
        }

        // Socket events
        socket.on('connect', () => {
            addLog('SYSTEM', 'Connected to alert manager');
        });

        socket.on('new-follower', (data) => {
            addLog('FOLLOWER', `${data.username} followed the channel`);
        });

        socket.on('new-subscriber', (data) => {
            addLog('SUBSCRIBER', `${data.username} subscribed (Tier ${data.tier/1000})`);
        });

        socket.on('donation', (data) => {
            addLog('DONATION', `${data.username} donated ${data.amount}`);
        });

        socket.on('cheer', (data) => {
            addLog('CHEER', `${data.username} cheered ${data.bits} bits`);
        });

        socket.on('raid', (data) => {
            addLog('RAID', `${data.username} raided with ${data.viewers} viewers`);
        });

        // Configuration Management Functions
        let streamProfiles = JSON.parse(localStorage.getItem('streamProfiles') || '{}');
        let selectedProfile = null;

        // Load current server configuration
        async function loadCurrentConfig() {
            try {
                const response = await fetch('/api/config');
                const config = await response.json();
                
                document.getElementById('currentChannel').value = config.TWITCH_CHANNEL || '';
                document.getElementById('currentBotUsername').value = config.TWITCH_BOT_USERNAME || '';
                document.getElementById('currentOAuthToken').value = config.TWITCH_OAUTH_TOKEN || '';
                document.getElementById('currentClientId').value = config.TWITCH_CLIENT_ID || '';
                document.getElementById('currentClientSecret').value = config.TWITCH_CLIENT_SECRET || '';
                document.getElementById('serverPort').value = config.PORT || '3000';
                document.getElementById('webhookUrl').value = config.WEBHOOK_URL || '';
                document.getElementById('webhookSecret').value = config.TWITCH_WEBHOOK_SECRET || '';
                
                addLog('CONFIG', 'Current configuration loaded');
            } catch (error) {
                addLog('ERROR', 'Failed to load current configuration');
                console.error('Failed to load config:', error);
            }
        }

        // Update current server configuration
        async function updateCurrentConfig() {
            const config = {
                TWITCH_CHANNEL: document.getElementById('currentChannel').value,
                TWITCH_BOT_USERNAME: document.getElementById('currentBotUsername').value,
                TWITCH_OAUTH_TOKEN: document.getElementById('currentOAuthToken').value,
                TWITCH_CLIENT_ID: document.getElementById('currentClientId').value,
                TWITCH_CLIENT_SECRET: document.getElementById('currentClientSecret').value,
                PORT: document.getElementById('serverPort').value,
                WEBHOOK_URL: document.getElementById('webhookUrl').value,
                TWITCH_WEBHOOK_SECRET: document.getElementById('webhookSecret').value
            };

            try {
                const response = await fetch('/api/config', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(config)
                });

                if (response.ok) {
                    addLog('CONFIG', 'Configuration updated successfully');
                    alert('Configuration updated! Server will restart to apply changes.');
                } else {
                    addLog('ERROR', 'Failed to update configuration');
                    alert('Failed to update configuration');
                }
            } catch (error) {
                addLog('ERROR', 'Error updating configuration');
                console.error('Update error:', error);
            }
        }

        // Save current configuration as a profile
        function saveProfile() {
            const profileName = document.getElementById('profileName').value;
            if (!profileName) {
                alert('Please enter a profile name');
                return;
            }

            const profile = {
                name: profileName,
                channel: document.getElementById('currentChannel').value,
                botUsername: document.getElementById('currentBotUsername').value,
                oauthToken: document.getElementById('currentOAuthToken').value,
                clientId: document.getElementById('currentClientId').value,
                clientSecret: document.getElementById('currentClientSecret').value,
                port: document.getElementById('serverPort').value,
                webhookUrl: document.getElementById('webhookUrl').value,
                webhookSecret: document.getElementById('webhookSecret').value,
                created: new Date().toISOString()
            };

            streamProfiles[profileName] = profile;
            localStorage.setItem('streamProfiles', JSON.stringify(streamProfiles));
            
            updateProfilesList();
            updateStreamSelector();
            addLog('CONFIG', `Profile "${profileName}" saved`);
            
            document.getElementById('profileName').value = '';
        }

        // Load a saved profile
        function loadProfile() {
            if (!selectedProfile) {
                alert('Please select a profile to load');
                return;
            }

            const profile = streamProfiles[selectedProfile];
            if (!profile) {
                alert('Profile not found');
                return;
            }

            document.getElementById('currentChannel').value = profile.channel || '';
            document.getElementById('currentBotUsername').value = profile.botUsername || '';
            document.getElementById('currentOAuthToken').value = profile.oauthToken || '';
            document.getElementById('currentClientId').value = profile.clientId || '';
            document.getElementById('currentClientSecret').value = profile.clientSecret || '';
            document.getElementById('serverPort').value = profile.port || '3000';
            document.getElementById('webhookUrl').value = profile.webhookUrl || '';
            document.getElementById('webhookSecret').value = profile.webhookSecret || '';

            addLog('CONFIG', `Profile "${selectedProfile}" loaded`);
        }

        // Delete a profile
        function deleteProfile() {
            if (!selectedProfile) {
                alert('Please select a profile to delete');
                return;
            }

            if (confirm(`Are you sure you want to delete profile "${selectedProfile}"?`)) {
                delete streamProfiles[selectedProfile];
                localStorage.setItem('streamProfiles', JSON.stringify(streamProfiles));
                
                updateProfilesList();
                updateStreamSelector();
                addLog('CONFIG', `Profile "${selectedProfile}" deleted`);
                selectedProfile = null;
            }
        }

        // Update profiles list display
        function updateProfilesList() {
            const profilesList = document.getElementById('profilesList');
            const profiles = Object.keys(streamProfiles);

            if (profiles.length === 0) {
                profilesList.innerHTML = '<p style="color: #b893ff; text-align: center;">No saved profiles</p>';
                return;
            }

            const profilesHtml = profiles.map(name => {
                const profile = streamProfiles[name];
                const isSelected = selectedProfile === name;
                return `
                    <div class="profile-item ${isSelected ? 'selected' : ''}" onclick="selectProfile('${name}')" style="
                        padding: 10px;
                        margin: 5px 0;
                        background: ${isSelected ? 'rgba(140, 255, 190, 0.2)' : 'rgba(140, 255, 190, 0.05)'};
                        border: 1px solid ${isSelected ? '#8cffbe' : 'rgba(140, 255, 190, 0.3)'};
                        border-radius: 6px;
                        cursor: pointer;
                        transition: all 0.3s ease;
                    ">
                        <div style="color: #8cffbe; font-weight: bold;">${name}</div>
                        <div style="color: #b893ff; font-size: 14px;">Channel: ${profile.channel}</div>
                        <div style="color: #b893ff; font-size: 12px;">Created: ${new Date(profile.created).toLocaleDateString()}</div>
                    </div>
                `;
            }).join('');

            profilesList.innerHTML = profilesHtml;
        }

        // Select a profile
        function selectProfile(name) {
            selectedProfile = name;
            updateProfilesList();
        }

        // Update stream selector dropdown
        function updateStreamSelector() {
            const selector = document.getElementById('streamSelector');
            const profiles = Object.keys(streamProfiles);

            selector.innerHTML = '<option value="">Select a stream...</option>';
            profiles.forEach(name => {
                const profile = streamProfiles[name];
                selector.innerHTML += `<option value="${name}">${name} (${profile.channel})</option>`;
            });
        }

        // Switch to selected stream
        async function switchToStream() {
            const selectedStream = document.getElementById('streamSelector').value;
            if (!selectedStream) {
                alert('Please select a stream');
                return;
            }

            const profile = streamProfiles[selectedStream];
            if (!profile) {
                alert('Stream profile not found');
                return;
            }

            // Load profile data into current config
            document.getElementById('currentChannel').value = profile.channel || '';
            document.getElementById('currentBotUsername').value = profile.botUsername || '';
            document.getElementById('currentOAuthToken').value = profile.oauthToken || '';
            document.getElementById('currentClientId').value = profile.clientId || '';
            document.getElementById('currentClientSecret').value = profile.clientSecret || '';

            // Apply the configuration
            await updateCurrentConfig();
            addLog('CONFIG', `Switched to stream: ${selectedStream}`);
        }

        // Add current stream to quick switcher
        function addQuickStream() {
            const channel = document.getElementById('currentChannel').value;
            if (!channel) {
                alert('Please enter a channel name first');
                return;
            }

            const profileName = `Quick_${channel}_${Date.now()}`;
            document.getElementById('profileName').value = profileName;
            saveProfile();
        }

        // Update server configuration
        async function updateServerConfig() {
            const config = {
                PORT: document.getElementById('serverPort').value,
                WEBHOOK_URL: document.getElementById('webhookUrl').value,
                TWITCH_WEBHOOK_SECRET: document.getElementById('webhookSecret').value
            };

            try {
                const response = await fetch('/api/server-config', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(config)
                });

                if (response.ok) {
                    addLog('CONFIG', 'Server configuration updated');
                    alert('Server configuration updated!');
                } else {
                    addLog('ERROR', 'Failed to update server configuration');
                }
            } catch (error) {
                addLog('ERROR', 'Error updating server configuration');
                console.error('Server config error:', error);
            }
        }

        // Export all configurations
        function exportAllConfigs() {
            const exportData = {
                profiles: streamProfiles,
                currentConfig: {
                    channel: document.getElementById('currentChannel').value,
                    botUsername: document.getElementById('currentBotUsername').value,
                    clientId: document.getElementById('currentClientId').value,
                    port: document.getElementById('serverPort').value,
                    webhookUrl: document.getElementById('webhookUrl').value
                },
                exportDate: new Date().toISOString(),
                version: '1.0'
            };

            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `worxed-stream-configs-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);

            addLog('CONFIG', 'All configurations exported');
        }

        // Import configurations
        function importConfigs() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const importData = JSON.parse(e.target.result);
                            
                            if (importData.profiles) {
                                streamProfiles = { ...streamProfiles, ...importData.profiles };
                                localStorage.setItem('streamProfiles', JSON.stringify(streamProfiles));
                                updateProfilesList();
                                updateStreamSelector();
                            }

                            if (importData.currentConfig) {
                                const config = importData.currentConfig;
                                document.getElementById('currentChannel').value = config.channel || '';
                                document.getElementById('currentBotUsername').value = config.botUsername || '';
                                document.getElementById('currentClientId').value = config.clientId || '';
                                document.getElementById('serverPort').value = config.port || '3000';
                                document.getElementById('webhookUrl').value = config.webhookUrl || '';
                            }

                            addLog('CONFIG', 'Configurations imported successfully');
                            alert('Configurations imported successfully!');
                        } catch (error) {
                            addLog('ERROR', 'Failed to import configurations');
                            alert('Error importing configurations: Invalid JSON file');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        // Apply JSON configuration
        function applyJsonConfig() {
            const jsonText = document.getElementById('configJson').value;
            if (!jsonText) {
                alert('Please paste a configuration JSON');
                return;
            }

            try {
                const config = JSON.parse(jsonText);
                
                if (config.TWITCH_CHANNEL) document.getElementById('currentChannel').value = config.TWITCH_CHANNEL;
                if (config.TWITCH_BOT_USERNAME) document.getElementById('currentBotUsername').value = config.TWITCH_BOT_USERNAME;
                if (config.TWITCH_OAUTH_TOKEN) document.getElementById('currentOAuthToken').value = config.TWITCH_OAUTH_TOKEN;
                if (config.TWITCH_CLIENT_ID) document.getElementById('currentClientId').value = config.TWITCH_CLIENT_ID;
                if (config.TWITCH_CLIENT_SECRET) document.getElementById('currentClientSecret').value = config.TWITCH_CLIENT_SECRET;
                if (config.PORT) document.getElementById('serverPort').value = config.PORT;
                if (config.WEBHOOK_URL) document.getElementById('webhookUrl').value = config.WEBHOOK_URL;
                if (config.TWITCH_WEBHOOK_SECRET) document.getElementById('webhookSecret').value = config.TWITCH_WEBHOOK_SECRET;

                addLog('CONFIG', 'JSON configuration applied');
                alert('Configuration applied! Click "Update Current Stream" to save changes.');
            } catch (error) {
                addLog('ERROR', 'Invalid JSON configuration');
                alert('Error: Invalid JSON format');
            }
        }

        // Initialize configuration management
        document.addEventListener('DOMContentLoaded', () => {
            updateProfilesList();
            updateStreamSelector();
            loadCurrentConfig();
        });
    </script>
</body>
</html> 